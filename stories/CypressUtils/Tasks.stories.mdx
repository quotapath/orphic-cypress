import { Canvas, Meta, Story } from "@storybook/addon-docs";
import { UnitTest } from "../../src/storybook/UnitTest";
import { Title } from "stories";

<Meta id="cypressutils-tasks" />

<Title name="ArbitraryTask" />

Should execute an arbitrary task and and get the result from a promise.

<Story
  name="ArbitraryTask"
  parameters={{
    cy: {
      "should execute an arbitrary task via task syntax": () => {
        cy.task("arbitraryTask", 2).then(($num) => expect($num).to.equal(2));
      },
    },
  }}
>
  <UnitTest name="ArbitraryTask" />
</Story>

<Title name="ArbitraryTaskWithCommandSyntax" />

Command task for more convenient ergonomics and well typed signature

<Story
  name="ArbitraryTaskWithCommandSyntax"
  parameters={{
    cy: {
      "should execute an arbitrary task via command syntax": () => {
        cy.arbitraryTask(2).then(($num) => expect($num).to.equal(2));
      },
    },
  }}
>
  <UnitTest name="ArbitraryTaskWithCommandSyntax" />
</Story>

# Literate Testing

There is no need for this to be a story instead of a simple `*.cy.ts` file,
but using orphic-cypress enables a fun literate testing syntax where even
unit tests could be written in mdx and display nicely in storybook for
documentation purposes.

Sourceloader does not work with mdx files (as far as I can tell), so I'll drop in a snippet here
for example's sake.

```tsx
<Story
  name="ArbitraryTaskWithCommandSyntax"
  parameters={{
    cy: {
      "should execute an arbitrary task via command syntax": () => {
        cy.arbitraryTask(2).then(($num) => expect($num).to.equal(2));
      },
    },
  }}
>
  <UnitTest name="ArbitraryTaskWithCommandSyntax" />
</Story>
```

## Some other formats

First `.cy` function with a `description` prop passed to `UnitTest`

<Story
  name="CyFunction"
  parameters={{
    cy() {
      cy.arbitraryTask(2).then(($num) => expect($num).to.equal(2));
    },
  }}
>
  <UnitTest
    name="CyFunction"
    description="should execute an arbitrary task via command syntax"
  />
</Story>

Then `.cyTest` function with multiple internal tests, but no description

<Story
  name="CyTest"
  parameters={{
    cyTest: () => {
      it("should get 3 in return", () => {
        cy.arbitraryTask(3).then(($num) => expect($num).to.equal(3));
      });
      // whitespace only allowed in mdx2 unfortunately
      it("should get 4 in return", () => {
        cy.arbitraryTask(4).then(($num) => expect($num).to.equal(4));
      });
    },
  }}
>
  <></>
</Story>

There's also no reason it has to actually be the story component either,
though there's some gotcha's to no-children stories, e.g. at least in mdx1,
you have to throw in a fake component like `<Story><></></Story>`.

<UnitTest name="CyTest" />
