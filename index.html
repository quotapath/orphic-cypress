<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Cypress Storybook Component Tests</title><meta name="description" content="Documentation for Cypress Storybook Component Tests"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"><a href="https://quotapath.github.io/orphic-cypress/storybook/">Storybook</a><a href="https://github.com/quotapath/orphic-cypress">Github</a></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Cypress Storybook Component Tests</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>Cypress Storybook Component Tests</h2></div>
<div class="tsd-panel tsd-typography"><div align="center">
  <img
    src="https://user-images.githubusercontent.com/9889378/203303857-c5e4682d-afda-4956-bd3b-d54630a7041c.jpeg"
    alt="Van Gogh's Painting of 'Road with Cypress and Star'"
    width="400px"
  />
</div>


<a href="#cypress-storybook-component-tests" id="cypress-storybook-component-tests" style="color: inherit; text-decoration: none;">
  <h1>Cypress Storybook Component Tests</h1>
</a>
<p><a href="https://quotapath.github.io/orphic-cypress/storybook/"><img src="https://raw.githubusercontent.com/storybookjs/brand/main/badge/badge-storybook.svg" alt="Storybook"></a> <a href="https://github.com/quotapath/orphic-cypress/actions/workflows/ci.yml"><img src="https://github.com/quotapath/orphic-cypress/actions/workflows/ci.yml/badge.svg" alt="CI"></a></p>
<p>A set of utilities, typescript transformers, and general examples on how to cover storybook stories with cypress component tests.
In short, this is a little overengineering, a little black magic, and a lot of documentation on making these kinds of tests as easy and concise as possible.</p>

<a href="#features" id="features" style="color: inherit; text-decoration: none;">
  <h2>Features</h2>
</a>
<ul>
<li><a href="https://quotapath.github.io/orphic-cypress/storybook/">A comprehensive set of examples</a> for using cypress to test storybook with or without tools given here, including some surprising finds <a href="https://quotapath.github.io/orphic-cypress/storybook/?path=/docs/mdx-file-with-external-tests">like how to use composeStories with mdx files</a></li>
<li>An automatic cypress component test executor for plain old storybook stories</li>
<li><a href="#additional-syntaxes">A series of file syntaxes</a> to support <code>.play</code> like functionality in story files</li>
<li><a href="#stubbing-actions">Automatic action stubs and spies</a> with first level cypress support</li>
<li><a href="#isolated-component-files-transformer">A typescript transform</a> that turns your <code>stories.tsx</code> files into cypress test files with just a bit of black magic</li>
<li>Tools for turning <a href="#intercepting-api-requests">storybook addon mock api calls into cypress intercepts</a></li>
<li><a href="https://quotapath.github.io/orphic-cypress/functions/story_code.transformSource.html">Some storysource snippet utils</a> to show sections of the source file as story code snippet</li>
</ul>
<p>See extended module documentation in <a href="https://quotapath.github.io/orphic-cypress/">github pages</a> and numerous examples at a <a href="https://quotapath.github.io/orphic-cypress/storybook/">hosted storybook</a></p>
<br/>


<a href="#what-this-is" id="what-this-is" style="color: inherit; text-decoration: none;">
  <h1>What this is</h1>
</a>
<p>We love storybook and component driven development, but we also love cypress!</p>
<p>We were initially excited about <a href="https://storybook.js.org/docs/react/writing-tests/interaction-testing">storybook&#39;s interaction testing</a>. We even wrote some tests and committed to this as the direction forward, translating over our early enzyme tests.</p>
<p>Ultimately though, we found that the bringing in net-new technologies like jest and testing-library would be too much cognitive overhead and dissonance alongside our end-to-end tests already written using cypress, and our unit tests already using the mocha/chai/sinon stack.</p>
<p>So, we set out to come up with a standard for executing storybook tests in cypress with just the right balance of spooky magic that we have minimal boilerplate, encourage writing tests early and often, and cover stories which don&#39;t have explicit tests. Although it&#39;s with a heavy heart that we leave behind some of the benefits of storybook&#39;s solution, we&#39;re thrilled to have test coverage that fits with our existing paradigms. And cypress component testing is really slick.</p>
<p>We also export a few helpers that we find useful for things like creating commands and tasks in typescript.</p>
<br/>


<a href="#using-this-package" id="using-this-package" style="color: inherit; text-decoration: none;">
  <h1>Using this package</h1>
</a>
<p>As is, you could set up cypress component testing following <a href="https://docs.cypress.io/guides/component-testing/quickstart-react#Configuring-Component-Testing">their guide</a> and write tests like this without any need for the code in this package.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">composeStories</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@storybook/testing-react&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">React</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;react&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">stories</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./index.stories&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">CompWithLabel</span><span class="hl-1"> } = </span><span class="hl-6">composeStories</span><span class="hl-1">(</span><span class="hl-2">stories</span><span class="hl-1">);</span><br/><br/><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-3">&quot;SomeComponent&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&quot;should render ok&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">mount</span><span class="hl-1">(&lt;</span><span class="hl-7">CompWithLabel</span><span class="hl-1"> /&gt;);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&quot;should show the provided label&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">mount</span><span class="hl-1">(&lt;</span><span class="hl-7">CompWithLabel</span><span class="hl-1"> /&gt;);</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.typography&quot;</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&quot;be.visible&quot;</span><span class="hl-1">).</span><span class="hl-6">and</span><span class="hl-1">(</span><span class="hl-3">&quot;contain&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;test&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code></pre>
<p>But, that could conceivably be seen as a lot of boilerplate, especially when compared to the <code>play</code> syntax of storybook&#39;s interactive tests. You&#39;d have to drop something like this into every directory containing a storybook story and perform the <code>should render ok</code> test to make sure your stories aren&#39;t breaking. And we haven&#39;t even gotten into things like stubbing actions or mocking API calls which would be duplicative of storybook setup.</p>
<p>Instead we could write some simple utilities so that we can keep the files in the <code>*.stories.tsx</code>:</p>
<pre><code class="language-ts"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">CompWithLabel</span><span class="hl-1"> = () </span><span class="hl-4">=&gt;</span><span class="hl-1"> &lt;</span><span class="hl-7">Something</span><span class="hl-1"> </span><span class="hl-7">label</span><span class="hl-1">=</span><span class="hl-3">&quot;test&quot;</span><span class="hl-1"> /&gt;; </span><span class="hl-8">// was already here</span><br/><span class="hl-2">CompWithLabel</span><span class="hl-1">.</span><span class="hl-6">cy</span><span class="hl-1"> = () </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.typography&quot;</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&quot;be.visible&quot;</span><span class="hl-1">).</span><span class="hl-6">and</span><span class="hl-1">(</span><span class="hl-3">&quot;contain&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;test&quot;</span><span class="hl-1">);</span>
</code></pre>
<br/>


<a href="#additional-syntaxes" id="additional-syntaxes" style="color: inherit; text-decoration: none;">
  <h1>Additional Syntaxes</h1>
</a>
<p>There are 3 available syntaxes for in-file use. See <a href="https://quotapath.github.io/orphic-cypress/storybook/?path=/docs/fileformats-storybookfiles">storybook</a> for comprehensive examples.</p>

<a href="#function-syntax" id="function-syntax" style="color: inherit; text-decoration: none;">
  <h2><code>function</code> syntax</h2>
</a>
<p>already shown above is the most succinct</p>
<pre><code class="language-ts"><span class="hl-2">CompWithLabel</span><span class="hl-1">.</span><span class="hl-6">cy</span><span class="hl-1"> = () </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.typography&quot;</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&quot;be.visible&quot;</span><span class="hl-1">).</span><span class="hl-6">and</span><span class="hl-1">(</span><span class="hl-3">&quot;contain&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;test&quot;</span><span class="hl-1">);</span>
</code></pre>

<a href="#object-syntax" id="object-syntax" style="color: inherit; text-decoration: none;">
  <h2><code>object</code> syntax</h2>
</a>
<p>allows you to tag the test with a description of the expectation and to write multiple tests for the same component</p>
<pre><code class="language-ts"><span class="hl-2">CompWithLabel</span><span class="hl-1">.</span><span class="hl-2">cy</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;should contain the &#39;test&#39; label&quot;</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.typography&quot;</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&quot;be.visible&quot;</span><span class="hl-1">).</span><span class="hl-6">and</span><span class="hl-1">(</span><span class="hl-3">&quot;contain&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;test&quot;</span><span class="hl-1">),</span><br/><br/><span class="hl-1">  </span><span class="hl-3">&quot;should show an expanded label when clicked&quot;</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.typography&quot;</span><span class="hl-1">).</span><span class="hl-6">click</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.expanded-label&quot;</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&quot;be.visible&quot;</span><span class="hl-1">).</span><span class="hl-6">and</span><span class="hl-1">(</span><span class="hl-3">&quot;contain&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;more details here&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">};</span>
</code></pre>
<p>Each of these is executed in it&#39;s own isolated <code>it</code> function.</p>

<a href="#cytest-syntax" id="cytest-syntax" style="color: inherit; text-decoration: none;">
  <h2><code>cyTest</code> syntax</h2>
</a>
<p>allows the most control but backs off of some of the automatic setup that takes place</p>
<pre><code class="language-ts"><span class="hl-2">CompWithLabel</span><span class="hl-1">.</span><span class="hl-6">cyTest</span><span class="hl-1"> = (</span><span class="hl-2">Story</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&quot;should contain the &#39;test&#39; label&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">mount</span><span class="hl-1">(&lt;</span><span class="hl-7">Story</span><span class="hl-1"> /&gt;);</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.typography&quot;</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&quot;be.visible&quot;</span><span class="hl-1">).</span><span class="hl-6">and</span><span class="hl-1">(</span><span class="hl-3">&quot;contain&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;test&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&quot;should show an expanded label when clicked&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">mount</span><span class="hl-1">(&lt;</span><span class="hl-7">Story</span><span class="hl-1"> </span><span class="hl-7">additionalArgs</span><span class="hl-1">=</span><span class="hl-3">&quot;more details&quot;</span><span class="hl-1"> /&gt;);</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.typography&quot;</span><span class="hl-1">).</span><span class="hl-6">click</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&quot;.expanded-label&quot;</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&quot;be.visible&quot;</span><span class="hl-1">).</span><span class="hl-6">and</span><span class="hl-1">(</span><span class="hl-3">&quot;contain&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;more details here&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">};</span>
</code></pre>
<p>This executes within it&#39;s own <code>describe</code> block and is useful for providing component props or setup not included in stories, or for writing <code>before</code>, <code>beforeEach</code>, etc hooks.</p>

<a href="#opting-out" id="opting-out" style="color: inherit; text-decoration: none;">
  <h2>Opting out</h2>
</a>
<p>You can opt out of allowing any or all of these syntaxes via cypress configuration. See <a href="https://quotapath.github.io/orphic-cypress/types/config.CyTestConfig.html">config module documentation</a> for more details.</p>
<br/>


<a href="#stubbing-actions" id="stubbing-actions" style="color: inherit; text-decoration: none;">
  <h1>Stubbing Actions</h1>
</a>
<p>By default, <code>composeStories</code> will not stub your actions. This package introduces <code>stubStoryActions</code> to do this automatically when running in the cypress test mode. See <a href="md-docs/modules/actions.md#stubstoryactions">its documentation</a> for manual use.</p>
<p>See <a href="https://quotapath.github.io/orphic-cypress/storybook/?path=/docs/stubactions">storybook</a> for example uses with various file types and configurations, and <a href="https://quotapath.github.io/orphic-cypress/functions/actions.stubStoryActions.html">module docs</a> for more details</p>
<p>Cypress component test stubs are really slick and the test runner provides a great, interactive interface for debugging</p>
<p><a href="https://user-images.githubusercontent.com/9889378/203308863-105eac48-a70a-4c21-a439-dead63ef0aed.mp4">https://user-images.githubusercontent.com/9889378/203308863-105eac48-a70a-4c21-a439-dead63ef0aed.mp4</a></p>
<br/>


<a href="#isolated-component-files-transformer" id="isolated-component-files-transformer" style="color: inherit; text-decoration: none;">
  <h1>Isolated Component Files Transformer</h1>
</a>
<p>TODO</p>
<br/>


<a href="#intercepting-api-requests" id="intercepting-api-requests" style="color: inherit; text-decoration: none;">
  <h1>Intercepting API Requests</h1>
</a>
<p>TODO</p>
<br/>


<a href="#a-general-overview-of-the-landscape" id="a-general-overview-of-the-landscape" style="color: inherit; text-decoration: none;">
  <h1>A General Overview of the Landscape</h1>
</a>

<a href="#what-are-component-tests" id="what-are-component-tests" style="color: inherit; text-decoration: none;">
  <h2>What are component tests?</h2>
</a>
<p>Component tests are near to unit tests in that they are low-level tests that cover small units of logic, but they also cover React (or other) components specifically and so have some concept of rendering that component in isolation to test against. This is highly preferable to end-to-end testing in that you can test in isolation from the rest of an application without a large amount of setup or database seeding, which means these tests will execute much faster. A lot has been said about component tests, so I won&#39;t go into too much detail on what they are or their value, but here&#39;s some further reading: </p>
<ul>
<li><a href="https://docs.cypress.io/guides/component-testing/writing-your-first-component-test">Cypress: Writing Your First Component Test</a></li>
<li><a href="https://reactjs.org/docs/testing.html">React: Testing Overview</a></li>
<li><a href="https://storybook.js.org/docs/react/writing-tests/interaction-testing">Storybook: Interaction Testing</a></li>
</ul>
<p>Lets take a simple example: we have a component that shows some copy if the user is not permissioned, but shows some copy and does a bit of logic if they do have access. Here&#39;s some pseudo-code of what you&#39;d expect to see as tests:</p>
<pre><code class="language-ts"><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&quot;should show copy for a user without permissions&quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">element</span><span class="hl-1"> = </span><span class="hl-6">render</span><span class="hl-1">(&lt;</span><span class="hl-7">OurComponent</span><span class="hl-1">&gt;);</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">element</span><span class="hl-1">.</span><span class="hl-2">text</span><span class="hl-1">).</span><span class="hl-2">to</span><span class="hl-1">.</span><span class="hl-6">equal</span><span class="hl-1">(</span><span class="hl-3">&quot;No soup for you!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&quot;should show details for a user &quot;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">element</span><span class="hl-1"> = </span><span class="hl-6">render</span><span class="hl-1">(&lt;</span><span class="hl-7">OurComponent</span><span class="hl-1"> </span><span class="hl-7">isPermissioned</span><span class="hl-1">={</span><span class="hl-2">true</span><span class="hl-1">} </span><span class="hl-7">flagCount</span><span class="hl-1">={</span><span class="hl-9">4</span><span class="hl-1">}&gt;);</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">element</span><span class="hl-1">.</span><span class="hl-2">text</span><span class="hl-1">).</span><span class="hl-2">to</span><span class="hl-1">.</span><span class="hl-6">equal</span><span class="hl-1">(</span><span class="hl-3">&quot;You have four flagged items you need to address&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">numToWord</span><span class="hl-1">).</span><span class="hl-2">to</span><span class="hl-1">.</span><span class="hl-2">be</span><span class="hl-1">.</span><span class="hl-2">calledOnce</span><span class="hl-1">.</span><span class="hl-6">with</span><span class="hl-1">(</span><span class="hl-9">4</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Storybook stories make fantastic jumping off points for testing because they&#39;re fundamentally designed to illustrate common use cases and already perform a majority of the work that&#39;d need to be done to setup for that component in terms of component state and mocking API or function calls.</p>
<hr>

<a href="#nice-to-haves-for-component-tests" id="nice-to-haves-for-component-tests" style="color: inherit; text-decoration: none;">
  <h3>Nice-to-haves for component tests</h3>
</a>
<ul>
<li>They execute quickly</li>
<li>They&#39;re as easy as possible to set up with minimal boilerplate</li>
<li>Optional headed execution so that you can visually see whats happening and debug in a real browser</li>
<li>When executing headlessly in CI for instance, screenshots on errors make for similarly easy debugging as local headed execution</li>
</ul>
<hr>

<a href="#comparison-of-existing-solutions" id="comparison-of-existing-solutions" style="color: inherit; text-decoration: none;">
  <h3>Comparison of Existing Solutions</h3>
</a>

<a href="#storybook-interactive-tests" id="storybook-interactive-tests" style="color: inherit; text-decoration: none;">
  <h4>Storybook interactive tests</h4>
</a>
<p>This is the standard that we&#39;re working against here. They&#39;ll look like this when using the story function syntax</p>
<pre><code class="language-ts"><span class="hl-2">SomeStory</span><span class="hl-1">.</span><span class="hl-6">play</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> ({ </span><span class="hl-2">canvasElement</span><span class="hl-1"> }) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">canvas</span><span class="hl-1"> = </span><span class="hl-6">within</span><span class="hl-1">(</span><span class="hl-2">canvasElement</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">canvas</span><span class="hl-1">.</span><span class="hl-6">getByTestId</span><span class="hl-1">(</span><span class="hl-3">&quot;Attainment&quot;</span><span class="hl-1">)).</span><span class="hl-6">toBeVisible</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-8">// Should not see earnings</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">canvas</span><span class="hl-1">.</span><span class="hl-6">queryByTestId</span><span class="hl-1">(</span><span class="hl-3">&quot;Earnings&quot;</span><span class="hl-1">)).</span><span class="hl-6">toEqual</span><span class="hl-1">(</span><span class="hl-4">null</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-8">// Should not see more menu</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">canvas</span><span class="hl-1">.</span><span class="hl-6">queryByTestId</span><span class="hl-1">(</span><span class="hl-3">&quot;moreMenu-team&quot;</span><span class="hl-1">)).</span><span class="hl-6">toEqual</span><span class="hl-1">(</span><span class="hl-4">null</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>
<ul>
<li>Pros:<ul>
<li>They’re built into storybook so you get to show interactive stories right there</li>
<li>We’ve already written some. Pretty smooth experience</li>
<li><code>actions</code> are automatically supplied and are stubs for easy testing</li>
</ul>
</li>
<li>Cons:<ul>
<li>It requires new knowledge. Jest and testing-library instead of cypress and chai, alongside some specifics to storybook execution</li>
<li>It’s a true pain to set up in CI. They have their own test runner in playwrite, but I couldn’t get it working with a quick pass in circleci. I built a custom cypress executor, but that broke when we moved to nginx.</li>
</ul>
</li>
</ul>
<hr>

<a href="#cypress-execution-of-builtin-interactive-tests-by-visiting-the-story39s-url-or-iframe" id="cypress-execution-of-builtin-interactive-tests-by-visiting-the-story39s-url-or-iframe" style="color: inherit; text-decoration: none;">
  <h4>Cypress execution of builtin interactive tests by visiting the story&#39;s url or iframe</h4>
</a>
<p>TODO</p>
<hr>

<a href="#cypress-component-tests-directly-without-storybook" id="cypress-component-tests-directly-without-storybook" style="color: inherit; text-decoration: none;">
  <h4>Cypress component tests directly without storybook</h4>
</a>
<p>They look like this (example pulled from cypress docs):</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Stepper</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&#39;stepper should default to 0&#39;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">mount</span><span class="hl-1">(&lt;</span><span class="hl-7">Stepper</span><span class="hl-1"> /&gt;)</span><br/><span class="hl-1">  </span><span class="hl-2">cy</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-2">counterSelector</span><span class="hl-1">).</span><span class="hl-6">should</span><span class="hl-1">(</span><span class="hl-3">&#39;have.text&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;0&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">})</span>
</code></pre>
<ul>
<li>Pros:<ul>
<li>We already all know cypress and its tooling</li>
<li>It&#39;s slick</li>
</ul>
</li>
<li>Cons:<ul>
<li>distinct from storybook (though see below) and so we lose that interconnectedness</li>
<li>still technically in beta, though its pretty sophisticated and clear they’re following through with it</li>
</ul>
</li>
</ul>
<hr>

<a href="#cypress-component-tests-using-storybook-components-what-this-project-does" id="cypress-component-tests-using-storybook-components-what-this-project-does" style="color: inherit; text-decoration: none;">
  <h4>Cypress component tests using storybook components. <strong>What this project does</strong></h4>
</a>
<p>These could be written in the storybook file with some type updates, or alongside in a new file. See <a href="#using-this-package">Using this package</a> above for an example of what this&#39;ll look like.</p>
<ul>
<li>Pros:<ul>
<li>We already know and love cypress</li>
<li>Uses stories as test cases, which reduces duplication and increases usefulness/documentative natures of both test and story</li>
</ul>
</li>
<li>Cons:<ul>
<li>Still wont appear in storybook so you’d still have to pull up a separate process to see the interactive story/test</li>
<li>currently only works with typescript or javascript story files, not mdx</li>
</ul>
</li>
</ul>
<hr>

<a href="#mocha-or-other-headless-execution-of-storybook-interactive-tests" id="mocha-or-other-headless-execution-of-storybook-interactive-tests" style="color: inherit; text-decoration: none;">
  <h4>Mocha or other headless execution of storybook interactive tests:</h4>
</a>
<p>TODO: Add in a realistic example</p>
<pre><code class="language-ts">
</code></pre>
<p>Use composeStories from above and then execute the .play</p>
<ul>
<li>Pros:<ul>
<li>back to tests being visible in storybook through interaction testing addon</li>
<li>simpler headless CI execution than storybook&#39;s playwrite executor</li>
</ul>
</li>
<li>Cons:<ul>
<li>only works with .tsx, not .mdx</li>
<li>we’d have to build out some infrastructure to support automatic discovery and execution</li>
<li>headless, so won’t get screens of component on error, but could still interact in storybook</li>
<li>back to having to know jest + testing-library</li>
</ul>
</li>
</ul>
<br/>


<a href="#whats-in-a-name" id="whats-in-a-name" style="color: inherit; text-decoration: none;">
  <h1>Whats in a name?</h1>
</a>
<p>When it comes to javascript naming, we find ourselves in a realm of mythology and powerful symbolism.
From the Greek cannon, we have the likes of Apollo and Ajax, from more recent invented myths we have Falcor, Mithril, and Zod.
The list goes on, and well it should, myths share with programming a deep understanding of the power of language and symbols.
Even in javascript testing we have Sinon, named for the Greek warrior who lied to the Trojans to convince them that the giant wooden horse at their gates was only a gift, and was totally not filled to the brim with his comrades. What a brilliant name for a mocking library.
So you&#39;d think that Cypress would join in on this tradition, the cypress being an ancient tree known throughout human culture. There is a wealth of deep symbolism there. Van Gogh claimed they looked like Egyptian obelisks and painted them with an intense fiery energy literally leaping out of the frame.</p>
<p>But no, if we dig around a bit, we find that <a href="https://docs.cypress.io/faq/questions/company-faq#Why-the-name-Cypress">cypress was named because</a></p>
<blockquote>
<p>We believe that tests should always pass -- in other words, should always be green. A cypress is an evergreen tree. So, Cypress!</p>
</blockquote>
<p>Lame. So utterly lame. So we&#39;re naming this after the <a href="https://repository.brynmawr.edu/cgi/viewcontent.cgi?article=1095&amp;context=classics_pubs">Orphic Tablets</a> which were found in the tombs of the Greeks which contained instructions on the afterlife, wherein a white cypress stands as a guidepost in that dark underworld. Fitting for tests which execute in a different realm.</p>
<blockquote>
<p>You will find in the halls of Hades a spring on the left, and standing by it, a glowing white cypress tree</p>
</blockquote>
<p>It&#39;s a literary, <em>storybook</em>, name. Why name a repo which is mostly examples? Just for fun.</p>

<a href="#prior-art" id="prior-art" style="color: inherit; text-decoration: none;">
  <h1>Prior Art</h1>
</a>
<p><a href="https://www.cypress.io/blog/2021/05/19/cypress-x-storybook-2-0/">Cypress&#39;s recommendation on component testing storybook</a> is essentially the &#39;what you can do without this package&#39;</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">Cypress <wbr/>Storybook <wbr/>Component <wbr/>Tests</a>
<ul>
<li class="tsd-kind-module"><a href="modules/actions.html">actions</a></li>
<li class="tsd-kind-module"><a href="modules/config.html">config</a></li>
<li class="tsd-kind-module"><a href="modules/cypress.html">cypress</a></li>
<li class="tsd-kind-module"><a href="modules/execute.html">execute</a></li>
<li class="tsd-kind-module"><a href="modules/intercept.html">intercept</a></li>
<li class="tsd-kind-module"><a href="modules/mount.html">mount</a></li>
<li class="tsd-kind-module"><a href="modules/story_code.html">story-<wbr/>code</a></li>
<li class="tsd-kind-module"><a href="modules/transformers.html">transformers</a></li>
<li class="tsd-kind-module"><a href="modules/types.html">types</a></li></ul></li></ul></div></details></nav></div></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>